<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Exodus: /test/create_mesh.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Exodus
   &#160;<span id="projectnumber">7.22</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_2test_2create_mesh_8c-example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/test/create_mesh.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Copyright(C) 1999-2020 National Technology &amp; Engineering Solutions</span></div>
<div class="line"><span class="comment"> * of Sandia, LLC (NTESS).  Under the terms of Contract DE-NA0003525 with</span></div>
<div class="line"><span class="comment"> * NTESS, the U.S. Government retains certain rights in this software.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * See packages/seacas/LICENSE for details</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="exodusII_8h.html">exodusII.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define DEFAULT_FILE_NAME &quot;mesh&quot;</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_MAP_ORIGIN 1</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_NUM_DOMAINS 1</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_NUM_ELEMENTS 1000000</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_NUM_FIELDS 0</span></div>
<div class="line"><span class="preprocessor">#define DEFAULT_NUM_TIMESTEPS 1</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_STRING_LEN 128</span></div>
<div class="line"><span class="preprocessor">#define NUM_BYTES_PER_INT 4</span></div>
<div class="line"><span class="preprocessor">#define NUM_NODES_PER_ELEM 8</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define EBLK_ID 100000</span></div>
<div class="line"><span class="preprocessor">#define EXODUSII_FILE_TYPE &quot;.e&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keywordtype">double</span> realtyp;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> int64_t INT;</div>
<div class="line"> </div>
<div class="line">INT StringToCount(<span class="keywordtype">char</span> *size_str)</div>
<div class="line">{</div>
<div class="line">  INT  size = 0;</div>
<div class="line">  <span class="keywordtype">char</span> range;</div>
<div class="line">  <span class="keywordtype">int</span>  rc;</div>
<div class="line"> </div>
<div class="line">  rc = sscanf(size_str, <span class="stringliteral">&quot;%&quot;</span> PRId64 <span class="stringliteral">&quot;%c&quot;</span>, &amp;size, &amp;range);</div>
<div class="line">  <span class="keywordflow">if</span> (rc == 2) {</div>
<div class="line">    <span class="keywordflow">switch</span> ((<span class="keywordtype">int</span>)range) {</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;k&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;K&#39;</span>: size *= 1000; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>: size *= 1000000; <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div>
<div class="line">    <span class="keywordflow">case</span> <span class="charliteral">&#39;G&#39;</span>: size *= 1000000000; <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rc == 0) {</div>
<div class="line">    size = -1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> (size);</div>
<div class="line">} <span class="comment">/* StringToCount() */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> get_file_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *base, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext, <span class="keywordtype">int</span> rank, <span class="keywordtype">int</span> nprocs, <span class="keyword">const</span> <span class="keywordtype">char</span> *other,</div>
<div class="line">                   <span class="keywordtype">char</span> *output);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* We need to do a cube-root to find the number of elements on each</span></div>
<div class="line"><span class="comment"> * side of the cube, but don&#39;t want to link in -lm just for</span></div>
<div class="line"><span class="comment"> * this. Use this routine which is better than</span></div>
<div class="line"><span class="comment"> * a brute force approach. Found at</span></div>
<div class="line"><span class="comment"> * http://www.hackersdelight.org/HDcode/icbrt.c</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">INT icbrt(<span class="keywordtype">unsigned</span> x)</div>
<div class="line">{</div>
<div class="line">  INT      s;</div>
<div class="line">  <span class="keywordtype">unsigned</span> y, b;</div>
<div class="line"> </div>
<div class="line">  s = 30;</div>
<div class="line">  y = 0;</div>
<div class="line">  <span class="keywordflow">while</span> (s &gt;= 0) { <span class="comment">/* Do 11 times. */</span></div>
<div class="line">    y = 2 * y;</div>
<div class="line">    b = (3 * y * (y + 1) + 1) &lt;&lt; s;</div>
<div class="line">    s = s - 3;</div>
<div class="line">    <span class="keywordflow">if</span> (x &gt;= b) {</div>
<div class="line">      x = x - b;</div>
<div class="line">      y = y + 1;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> y;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Prototypes */</span></div>
<div class="line"><span class="keywordtype">void</span> create_rr_elem_map(INT loc_num_elements, INT *elem_map, INT map_origin, INT num_domains,</div>
<div class="line">                        INT current_domain);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> create_elem_map(INT loc_num_elems, INT elem_num, INT *elem_map, INT map_origin);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> create_local_connect(INT *node_map, INT len_node_map, INT len_connect, INT *domain_connect,</div>
<div class="line">                          INT *loc_connect, INT map_origin);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> extract_connect(INT element_offset, INT num_elem, INT *elem_map, INT *connect,</div>
<div class="line">                     INT *domain_connect, INT map_origin);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> make_mesh(realtyp *x, realtyp *y, realtyp *z, INT *connect, INT map_origin,</div>
<div class="line">               INT num_elements_1d);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> parse_input(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[], <span class="keywordtype">bool</span> *debug, INT *map_origin, INT *num_elements_1d,</div>
<div class="line">                 INT *num_domains, INT *num_nodal_fields, INT *num_global_fields,</div>
<div class="line">                 INT *num_element_fields, INT *num_timesteps, <span class="keywordtype">char</span> *file_name, <span class="keywordtype">int</span> *exodus,</div>
<div class="line">                 <span class="keywordtype">int</span> *compression_level, <span class="keywordtype">int</span> *shuffle, <span class="keywordtype">int</span> *int64bit);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> write_exo_mesh(<span class="keywordtype">int</span> debug, <span class="keywordtype">char</span> *file_name, INT map_origin, INT num_nodes, INT num_elements,</div>
<div class="line">                    INT num_domains, INT num_nodal_fields, INT num_global_fields,</div>
<div class="line">                    INT num_element_fields, INT num_timesteps, realtyp *x, realtyp *y, realtyp *z,</div>
<div class="line">                    INT *connect, <span class="keywordtype">int</span> compression_level, <span class="keywordtype">int</span> shuffle, <span class="keywordtype">int</span> int64bit);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> create_node_map(INT len_map, INT len_connect, INT *domain_connect, INT *node_map,</div>
<div class="line">                     INT *loc_num_nodes, INT map_origin);</div>
<div class="line"> </div>
<div class="line">INT bin_search2(INT value, INT num, INT List[]);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Main function</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">  INT *connect;</div>
<div class="line">  <span class="keywordtype">bool</span> debug = <span class="keyword">false</span>; <span class="comment">/* true, display debug information; false       */</span></div>
<div class="line">  <span class="comment">/* otherwise.                                 */</span></div>
<div class="line">  <span class="keyword">static</span> <span class="keywordtype">char</span> file_name[MAX_STRING_LEN] = DEFAULT_FILE_NAME;</div>
<div class="line">  <span class="keywordtype">int</span>         exodus                    = <span class="keyword">true</span>;</div>
<div class="line">  INT         map_origin                = DEFAULT_MAP_ORIGIN;</div>
<div class="line">  INT         num_domains               = DEFAULT_NUM_DOMAINS;</div>
<div class="line">  INT         num_elements_1d;</div>
<div class="line">  INT         num_elements       = DEFAULT_NUM_ELEMENTS;</div>
<div class="line">  INT         num_nodal_fields   = DEFAULT_NUM_FIELDS;</div>
<div class="line">  INT         num_global_fields  = DEFAULT_NUM_FIELDS;</div>
<div class="line">  INT         num_element_fields = DEFAULT_NUM_FIELDS;</div>
<div class="line">  INT         num_timesteps      = DEFAULT_NUM_TIMESTEPS;</div>
<div class="line">  INT         num_nodes;</div>
<div class="line">  <span class="keywordtype">int</span>         compression_level = 0;</div>
<div class="line">  <span class="keywordtype">int</span>         shuffle           = 0;</div>
<div class="line">  <span class="keywordtype">int</span>         int64bit          = 0;</div>
<div class="line">  <span class="keywordtype">size_t</span>      size;</div>
<div class="line"> </div>
<div class="line">  realtyp *x;</div>
<div class="line">  realtyp *y;</div>
<div class="line">  realtyp *z;</div>
<div class="line"> </div>
<div class="line">  <a name="a0"></a><a class="code" href="group__Utilities.html#ga8f47bbb035d32bbafc594c5ed3c00403">ex_opts</a>(<a name="a1"></a><a class="code" href="exodusII_8h.html#a8e04765c48d2d3c6806dc89d6c3db1feae2153f7d84ce02bf6947dae81018d5d9">EX_VERBOSE</a> | <a name="a2"></a><a class="code" href="exodusII_8h.html#a8e04765c48d2d3c6806dc89d6c3db1feac85b3327ce99395f3faf0d542b8b3a0a">EX_ABORT</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Parse Input */</span></div>
<div class="line">  parse_input(argc, argv, &amp;debug, &amp;map_origin, &amp;num_elements, &amp;num_domains, &amp;num_nodal_fields,</div>
<div class="line">              &amp;num_global_fields, &amp;num_element_fields, &amp;num_timesteps, file_name, &amp;exodus,</div>
<div class="line">              &amp;compression_level, &amp;shuffle, &amp;int64bit);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Create Coordinates and Connectivity Array */</span></div>
<div class="line">  num_elements_1d = icbrt(num_elements);</div>
<div class="line">  num_nodes       = (num_elements_1d + 1) * (num_elements_1d + 1) * (num_elements_1d + 1);</div>
<div class="line">  x               = malloc(num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">  y               = malloc(num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">  z               = malloc(num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">  assert(x != NULL &amp;&amp; y != NULL &amp;&amp; z != NULL);</div>
<div class="line"> </div>
<div class="line">  num_elements = num_elements_1d * num_elements_1d * num_elements_1d;</div>
<div class="line">  size         = (size_t)NUM_NODES_PER_ELEM * num_elements * <span class="keyword">sizeof</span>(INT);</div>
<div class="line">  assert(size &gt; 0);</div>
<div class="line">  connect = malloc(size);</div>
<div class="line">  assert(connect != NULL);</div>
<div class="line"> </div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;Creating a 3D mesh of %&quot;</span> PRId64 <span class="stringliteral">&quot; hex elements and %&quot;</span> PRId64 <span class="stringliteral">&quot; nodes.\n&quot;</span>,</div>
<div class="line">          num_elements, num_nodes);</div>
<div class="line"> </div>
<div class="line">  make_mesh(x, y, z, connect, map_origin, num_elements_1d);</div>
<div class="line">  fprintf(stderr, <span class="stringliteral">&quot;\t...Mesh topology created.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">   *    Write Out Mesh</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (exodus) {</div>
<div class="line">    write_exo_mesh(debug, file_name, map_origin, num_nodes, num_elements, num_domains,</div>
<div class="line">                   num_nodal_fields, num_global_fields, num_element_fields, num_timesteps, x, y, z,</div>
<div class="line">                   connect, compression_level, shuffle, int64bit);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  free(x);</div>
<div class="line">  free(y);</div>
<div class="line">  free(z);</div>
<div class="line">  free(connect);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">} <span class="comment">/* end of main() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> parse_input(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[], <span class="keywordtype">bool</span> *debug, INT *map_origin, INT *num_elements_1d,</div>
<div class="line">                 INT *num_domains, INT *num_nodal_fields, INT *num_global_fields,</div>
<div class="line">                 INT *num_element_fields, INT *num_timesteps, <span class="keywordtype">char</span> *file_name, <span class="keywordtype">int</span> *exodus,</div>
<div class="line">                 <span class="keywordtype">int</span> *compression_level, <span class="keywordtype">int</span> *shuffle, <span class="keywordtype">int</span> *int64bit)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> arg = 0; <span class="comment">/* Argument index.      */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">while</span> (++arg &lt; argc) {</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-c&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_nodal_fields = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-compress&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *compression_level = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-shuffle&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      *shuffle = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-64&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      *int64bit = 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-nv&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_nodal_fields = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-gv&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_global_fields = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-ev&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_element_fields = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-t&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_timesteps = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-d&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      *debug = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-f&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        <a name="a3"></a><a class="code" href="exodusII_8h.html#af1f4f3b83e65c1415d915910a48463ea">ex_copy_string</a>(file_name, argv[arg], MAX_STRING_LEN);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-m&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *map_origin = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-n&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_elements_1d = StringToCount(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-p&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      <span class="keywordflow">if</span> (++arg &lt; argc) {</div>
<div class="line">        *num_domains = atoi(argv[arg]);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;-x&quot;</span>, argv[arg]) == 0) {</div>
<div class="line">      *exodus = <span class="keyword">true</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((strcmp(<span class="stringliteral">&quot;-h&quot;</span>, argv[arg]) == 0) || (strcmp(<span class="stringliteral">&quot;-u&quot;</span>, argv[arg]) == 0)) {</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;NAME                                                            \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;create_mesh - creates a mesh file for performance benchmarking. \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;SYNOPSIS                                                        \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;create_mesh [-c fields] [-t timesteps] [-d] [-f file_name] \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;            [-m map_origin] [-n elements] [-p domains]          \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;            [-nv number] [-ev number] [-gv number] &quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;            [-r] [-u] [-h] &quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;[-x]&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                 \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;DESCRIPTION                                                     \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;This program creates a 3-D mesh for performance benchmarking.   \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;The EXODUSII II database file(s) created by this       \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;prrogram is/are read by the rd_wt_mesh program to perform the   \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;actual benchmark.                                               \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;OPTIONS                                                         \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-c  fields     number of nodal   fields. Default: %d            \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_FIELDS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-nv fields     number of nodal   fields. Default: %d            \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_FIELDS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-ev fields     number of element fields. Default: %d           \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_FIELDS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-gv fields     number of global  fields. Default: %d            \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_FIELDS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-t timesteps   number of timesteps. Default: %d                 \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_TIMESTEPS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-d             display debug information.                         \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-f file_name   file name prefix for all created files:          \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                  &#39;file_name&#39;_n%s [EXODUSII II file]              \n&quot;</span>,</div>
<div class="line">             EXODUSII_FILE_TYPE);</div>
<div class="line">      printf(<span class="stringliteral">&quot;                                                                \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;               where n varies from 0 to number of domains-1.  \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;               Default: %s                                      \n&quot;</span>,</div>
<div class="line">             DEFAULT_FILE_NAME);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-h             display help/usage information.                  \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-m map_origin  element map origin. Default: %d                  \n&quot;</span>,</div>
<div class="line">             DEFAULT_MAP_ORIGIN);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-n elements    number of elements in mesh   \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;               Can suffix with &#39;k&#39;, &#39;m&#39;, &#39;g&#39; for thousand, million, billion\n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;               elements/file = elements/number_of_domains.      \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;               Default: %d                                      \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_ELEMENTS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-p domains     number of domains. Default: %d                   \n&quot;</span>,</div>
<div class="line">             DEFAULT_NUM_DOMAINS);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-compress val  set compression to level &#39;val&#39; [0..9]            \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-shuffle       enable hdf5-shuffle                              \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-64            enable 64-bit integers                           \n&quot;</span>);</div>
<div class="line">      printf(<span class="stringliteral">&quot;-u             display help/usage information.                  \n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      exit(0);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Unknown option: %s\n&quot;</span>, argv[arg]);</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Enter create_mesh -h for description of valid options.\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      exit(0);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Create the coordinates and connectivity array for the mesh</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> make_mesh(realtyp *x, realtyp *y, realtyp *z, INT *connect, INT map_origin,</div>
<div class="line">               INT num_elements_1d)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">size_t</span> i, j, k, m, base, cnt;</div>
<div class="line">  <span class="keywordtype">size_t</span> elp1sq = (num_elements_1d + 1) * (num_elements_1d + 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create global coordinates */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (m = 0, k = 0; m &lt; (num_elements_1d + 1); m++) {</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; (num_elements_1d + 1); i++) {</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; (num_elements_1d + 1); j++, k++) {</div>
<div class="line">        x[k] = (realtyp)j;</div>
<div class="line">        y[k] = (realtyp)i;</div>
<div class="line">        z[k] = (realtyp)m;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* build connectivity array (node list) for mesh */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (m = 0, k = 0, cnt = 0; m &lt; num_elements_1d; m++) {</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, k = 0; i &lt; num_elements_1d; i++) {</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_elements_1d; j++, k++) {</div>
<div class="line">        base           = (m * elp1sq) + k + i + map_origin;</div>
<div class="line">        connect[cnt++] = base;</div>
<div class="line">        connect[cnt++] = base + 1;</div>
<div class="line">        connect[cnt++] = base + num_elements_1d + 2;</div>
<div class="line">        connect[cnt++] = base + num_elements_1d + 1;</div>
<div class="line"> </div>
<div class="line">        connect[cnt++] = elp1sq + base;</div>
<div class="line">        connect[cnt++] = elp1sq + base + 1;</div>
<div class="line">        connect[cnt++] = elp1sq + base + num_elements_1d + 2;</div>
<div class="line">        connect[cnt++] = elp1sq + base + num_elements_1d + 1;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">} <span class="comment">/* end of make_mesh() */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> write_exo_mesh(<span class="keywordtype">int</span> debug, <span class="keywordtype">char</span> *file_name, INT map_origin, INT num_nodes, INT num_elements,</div>
<div class="line">                    INT num_domains, INT num_nodal_fields, INT num_global_fields,</div>
<div class="line">                    INT num_element_fields, INT num_timesteps, realtyp *x, realtyp *y, realtyp *z,</div>
<div class="line">                    INT *connect, <span class="keywordtype">int</span> compression_level, <span class="keywordtype">int</span> shuffle, <span class="keywordtype">int</span> int64bit)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>  CPU_word_size = <span class="keyword">sizeof</span>(realtyp);</div>
<div class="line">  <span class="keywordtype">int</span>  IO_word_size  = <span class="keyword">sizeof</span>(realtyp);</div>
<div class="line">  <span class="keywordtype">int</span>  exoid, err, num_dim, num_elem_blk, num_node_sets, num_side_sets;</div>
<div class="line">  INT  i, j, t, index, loc_num_elements, loc_num_nodes, len_connect;</div>
<div class="line">  INT *elem_map = NULL, *node_map = NULL, *domain_connect = NULL, *loc_connect = NULL;</div>
<div class="line">  <span class="keywordtype">int</span> *elem_var_tab;</div>
<div class="line">  INT  accum_num_elements = 0;</div>
<div class="line">  INT  loc_node_size      = -1;</div>
<div class="line"> </div>
<div class="line">  realtyp *loc_xcoords = NULL;</div>
<div class="line">  realtyp *loc_ycoords = NULL;</div>
<div class="line">  realtyp *loc_zcoords = NULL;</div>
<div class="line">  realtyp *globals     = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">char</span>   temporary_name[MAX_STRING_LEN];</div>
<div class="line">  <span class="keywordtype">char</span> **var_name;</div>
<div class="line"> </div>
<div class="line">  accum_num_elements = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; num_domains; i++) {</div>
<div class="line">    <span class="keywordtype">int</span> mymode = <a name="a4"></a><a class="code" href="group__FileVars.html#ga6eb827ba708bd54aa72a5ac8468d4093">EX_MAPS_INT64_API</a> | <a name="a5"></a><a class="code" href="group__FileVars.html#ga0f0209ea697749096d1067c65ad57087">EX_BULK_INT64_API</a> | <a name="a6"></a><a class="code" href="group__FileVars.html#ga8163fd2a9d4320d3a452bbd54ee6a512">EX_IDS_INT64_API</a>;</div>
<div class="line">    <span class="keywordflow">if</span> (int64bit) {</div>
<div class="line">      mymode |= <a name="a7"></a><a class="code" href="group__FileVars.html#ga8b79c74f5807228669456780e4cdc6a9">EX_MAPS_INT64_DB</a> | <a name="a8"></a><a class="code" href="group__FileVars.html#ga5527c0f72dbf64338abf0a3e1fc01e10">EX_BULK_INT64_DB</a> | <a name="a9"></a><a class="code" href="group__FileVars.html#ga01a03e58adddc706f5a34030746d604a">EX_IDS_INT64_DB</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* create the EXODUSII file */</span></div>
<div class="line">    get_file_name(file_name, <span class="stringliteral">&quot;e&quot;</span>, i, num_domains, NULL, temporary_name);</div>
<div class="line"> </div>
<div class="line">    exoid = <a name="a10"></a><a class="code" href="group__Utilities.html#ga37c928f7e30c333ee7c704d04f7e3a87">ex_create</a>(temporary_name, <a name="a11"></a><a class="code" href="group__FileVars.html#gadeed66ded179e51a8858254052a76ba4">EX_CLOBBER</a> | mymode, &amp;CPU_word_size, &amp;IO_word_size);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (exoid &lt; 0) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_create, error = %d\n&quot;</span>, exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a name="a12"></a><a class="code" href="group__Utilities.html#gab9398d414e1316177db89782ed2a08c4">ex_set_option</a>(exoid, <a name="a13"></a><a class="code" href="group__FileOptions.html#gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0a56598a35ce7443245ddcd3370e7527b2">EX_OPT_COMPRESSION_LEVEL</a>, compression_level);</div>
<div class="line">    <a class="code" href="group__Utilities.html#gab9398d414e1316177db89782ed2a08c4">ex_set_option</a>(exoid, <a name="a14"></a><a class="code" href="group__FileOptions.html#gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0ad067190db4fac3cbc8f5c4f99a1c322a">EX_OPT_COMPRESSION_SHUFFLE</a>, shuffle);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_domains &gt; 1) {</div>
<div class="line">      <span class="comment">/* Determine local number of elements */</span></div>
<div class="line">      <span class="keywordflow">if</span> (num_elements &lt; num_domains) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;number of elements is less than number of domains.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; num_elements) {</div>
<div class="line">          loc_num_elements = 1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">          loc_num_elements = 0;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        loc_num_elements = num_elements / num_domains;</div>
<div class="line">        <span class="keywordflow">if</span> (i &lt; (num_elements % num_domains)) {</div>
<div class="line">          loc_num_elements++;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      len_connect = NUM_NODES_PER_ELEM * loc_num_elements;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* malloc things we need */</span></div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (i == 0) { <span class="comment">/* first time through; max size arrays occur on</span></div>
<div class="line"><span class="comment">                       first iteration */</span></div>
<div class="line">        elem_map       = malloc(loc_num_elements * <span class="keyword">sizeof</span>(INT));</div>
<div class="line">        domain_connect = malloc(len_connect * <span class="keyword">sizeof</span>(INT));</div>
<div class="line">        loc_connect    = malloc(len_connect * <span class="keyword">sizeof</span>(INT));</div>
<div class="line">        node_map       = malloc(num_nodes * <span class="keyword">sizeof</span>(INT));</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* Create element local/global map */</span></div>
<div class="line">      create_elem_map(loc_num_elements, accum_num_elements, elem_map, map_origin);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* Extract current domain&#39;s connectivity, referencing global node ids */</span></div>
<div class="line">      extract_connect(accum_num_elements, loc_num_elements, elem_map, connect, domain_connect,</div>
<div class="line">                      map_origin);</div>
<div class="line"> </div>
<div class="line">      accum_num_elements += loc_num_elements;</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* The local/global node map is just the current domain&#39;s connectivity,</span></div>
<div class="line"><span class="comment">         sorted with duplicate entries removed */</span></div>
<div class="line">      create_node_map(num_nodes, len_connect, domain_connect, node_map, &amp;loc_num_nodes, map_origin);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* Using local/global node map, convert the domain connectivity</span></div>
<div class="line"><span class="comment">         (referencing global node ids) to local connectivity (referencing</span></div>
<div class="line"><span class="comment">         local node ids) */</span></div>
<div class="line"> </div>
<div class="line">      create_local_connect(node_map, loc_num_nodes, len_connect, domain_connect, loc_connect,</div>
<div class="line">                           map_origin);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      loc_num_elements = num_elements;</div>
<div class="line">      loc_num_nodes    = num_nodes;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (debug) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\n\n\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\n domain: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, i);</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\n loc_num_elements: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, loc_num_elements);</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\n loc_num_nodes: %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, loc_num_nodes);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    num_dim       = 3;</div>
<div class="line">    num_elem_blk  = 1;</div>
<div class="line">    num_node_sets = 0;</div>
<div class="line">    num_side_sets = 0;</div>
<div class="line"> </div>
<div class="line">    err = <a name="a15"></a><a class="code" href="group__ModelDescription.html#gaad1d6ddd57d1fa8f94da25d505e8c7ba">ex_put_init</a>(exoid, <span class="stringliteral">&quot;This is an EXODUSII performance test.&quot;</span>, num_dim, loc_num_nodes,</div>
<div class="line">                      loc_num_elements, num_elem_blk, num_node_sets, num_side_sets);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_put_init, error = %d\n&quot;</span>, err);</div>
<div class="line">      <a name="a16"></a><a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Extract the local x and y coordinates */</span></div>
<div class="line">    <span class="keywordflow">if</span> (num_domains &gt; 1) {</div>
<div class="line">      <span class="keywordflow">if</span> (loc_num_nodes &gt; loc_node_size) {</div>
<div class="line">        loc_xcoords   = realloc(loc_xcoords, loc_num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">        loc_ycoords   = realloc(loc_ycoords, loc_num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">        loc_zcoords   = realloc(loc_zcoords, loc_num_nodes * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">        loc_node_size = loc_num_nodes;</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; loc_num_nodes; j++) {</div>
<div class="line">        index          = node_map[j] - map_origin;</div>
<div class="line">        loc_xcoords[j] = x[index];</div>
<div class="line">        loc_ycoords[j] = y[index];</div>
<div class="line">        loc_zcoords[j] = z[index];</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      err = <a name="a17"></a><a class="code" href="group__ModelDescription.html#ga7b04e195e3fa979ba07470b860d70145">ex_put_coord</a>(exoid, loc_xcoords, loc_ycoords, loc_zcoords);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      err = <a class="code" href="group__ModelDescription.html#ga7b04e195e3fa979ba07470b860d70145">ex_put_coord</a>(exoid, x, y, z);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_put_coord, error = %d\n&quot;</span>, err);</div>
<div class="line">      <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (debug) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\tCoordinates output.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#if 1</span></div>
<div class="line">    {</div>
<div class="line">      INT   ids[1] = {EBLK_ID};</div>
<div class="line">      INT   num_elem_per_block[1];</div>
<div class="line">      <span class="keywordtype">char</span> *names[1] = {<span class="stringliteral">&quot;hex&quot;</span>};</div>
<div class="line">      INT   num_node_per_elem[1];</div>
<div class="line">      INT   num_attr_per_block[1];</div>
<div class="line">      <span class="keywordtype">bool</span>  write_map       = num_domains &gt; 1 ? true : <span class="keyword">false</span>;</div>
<div class="line">      num_elem_per_block[0] = loc_num_elements;</div>
<div class="line">      num_node_per_elem[0]  = NUM_NODES_PER_ELEM;</div>
<div class="line">      num_attr_per_block[0] = 0;</div>
<div class="line">      err = <a name="a18"></a><a class="code" href="group__ModelDescription.html#ga03cff8e6e59a2c6b56cc1f232c2898c8">ex_put_concat_elem_block</a>(exoid, ids, names, num_elem_per_block, num_node_per_elem,</div>
<div class="line">                                     num_attr_per_block, write_map);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    err = <a name="a19"></a><a class="code" href="group__ModelDescription.html#gad98c043e0e089bcb7a4f6662f96f7822">ex_put_block</a>(exoid, <a name="a20"></a><a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a>, 10000000000, <span class="stringliteral">&quot;hex&quot;</span>, loc_num_elements,</div>
<div class="line">                       NUM_NODES_PER_ELEM, 0);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_put_elem_block, error = %d\n&quot;</span>, err);</div>
<div class="line">      <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_domains &gt; 1) {</div>
<div class="line">      err = <a name="a21"></a><a class="code" href="group__ModelDescription.html#ga359b6d011348ed04746217e67612f3c1">ex_put_conn</a>(exoid, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a>, EBLK_ID, loc_connect, NULL, NULL);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      err = <a class="code" href="group__ModelDescription.html#ga359b6d011348ed04746217e67612f3c1">ex_put_conn</a>(exoid, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a>, EBLK_ID, connect, NULL, NULL);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_put_elem_conn, error = %d\n&quot;</span>, err);</div>
<div class="line">      <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (debug) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\tConnectivity output.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* write out element and node maps */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_domains &gt; 1) {</div>
<div class="line">      err = <a name="a22"></a><a class="code" href="group__ModelDescription.html#gaedc9233bcc6ffe7c634d67bd305ace2a">ex_put_id_map</a>(exoid, <a name="a23"></a><a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a4a98c34aed1692f0d9c87f0e0912588a">EX_NODE_MAP</a>, node_map);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (err) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;after ex_put_id_map, error = %d\n&quot;</span>, err);</div>
<div class="line">        <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">        exit(-1);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      err = <a class="code" href="group__ModelDescription.html#gaedc9233bcc6ffe7c634d67bd305ace2a">ex_put_id_map</a>(exoid, <a name="a24"></a><a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aade15ee9d30e8609779682eadccf1291">EX_ELEM_MAP</a>, elem_map);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (err) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;after ex_put_id_map, error = %d\n&quot;</span>, err);</div>
<div class="line">        <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">        exit(-1);</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (debug) {</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;\tMaps output.\n&quot;</span>);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* write out simulated results fields;</span></div>
<div class="line"><span class="comment">       we&#39;ll just write out the x coordinate field &#39;num_nodal_fields&#39; times */</span></div>
<div class="line">    <span class="keywordflow">if</span> (loc_num_nodes &lt; loc_num_elements) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;INTERNAL ERROR: Programmer assumed number of nodes &gt; number of elements, &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;but that is not true.\n&quot;</span>);</div>
<div class="line">      <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_element_fields &gt; 0) {</div>
<div class="line">      elem_var_tab = malloc(num_element_fields * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_element_fields; j++) {</div>
<div class="line">        elem_var_tab[j] = 1;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      elem_var_tab = 0;</div>
<div class="line">    }</div>
<div class="line">    err = <a name="a25"></a><a class="code" href="group__ResultsData.html#ga4e10ac1ef1f40d2941f7918d527e539d">ex_put_all_var_param</a>(exoid, num_global_fields, num_nodal_fields, num_element_fields,</div>
<div class="line">                               elem_var_tab, 0, 0, 0, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_put_all_var_param, error = %d\n&quot;</span>, err);</div>
<div class="line">      <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_nodal_fields &gt; 0) {</div>
<div class="line"> </div>
<div class="line">      var_name = malloc(num_nodal_fields * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_nodal_fields; j++) {</div>
<div class="line">        var_name[j] = malloc((MAX_STRING_LEN + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line">        sprintf(var_name[j], <span class="stringliteral">&quot;node_field_%&quot;</span> PRId64, j + 1);</div>
<div class="line">      }</div>
<div class="line">      err = <a name="a26"></a><a class="code" href="group__ResultsData.html#gae487ed3a7cd9dcef6eca2ca6dac0f48b">ex_put_variable_names</a>(exoid, <a name="a27"></a><a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a7976e7fb59368794c38ff5da95b19873">EX_NODAL</a>, num_nodal_fields, var_name);</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_nodal_fields; j++) {</div>
<div class="line">        free(var_name[j]);</div>
<div class="line">      }</div>
<div class="line">      free(var_name);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_global_fields &gt; 0) {</div>
<div class="line">      globals  = malloc(num_global_fields * <span class="keyword">sizeof</span>(realtyp));</div>
<div class="line">      var_name = malloc(num_global_fields * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_global_fields; j++) {</div>
<div class="line">        var_name[j] = malloc((MAX_STRING_LEN + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line">        sprintf(var_name[j], <span class="stringliteral">&quot;global_field_%&quot;</span> PRId64, j + 1);</div>
<div class="line">        globals[j] = j;</div>
<div class="line">      }</div>
<div class="line">      err = <a class="code" href="group__ResultsData.html#gae487ed3a7cd9dcef6eca2ca6dac0f48b">ex_put_variable_names</a>(exoid, <a name="a28"></a><a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a890b3a596358b8fe3bee8771f4ac84ac">EX_GLOBAL</a>, num_global_fields, var_name);</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_global_fields; j++) {</div>
<div class="line">        free(var_name[j]);</div>
<div class="line">      }</div>
<div class="line">      free(var_name);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_element_fields &gt; 0) {</div>
<div class="line">      free(elem_var_tab);</div>
<div class="line">      var_name = malloc(num_element_fields * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_element_fields; j++) {</div>
<div class="line">        var_name[j] = malloc((MAX_STRING_LEN + 1) * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>));</div>
<div class="line">        sprintf(var_name[j], <span class="stringliteral">&quot;element_field_%&quot;</span> PRId64, j + 1);</div>
<div class="line">      }</div>
<div class="line">      err = <a class="code" href="group__ResultsData.html#gae487ed3a7cd9dcef6eca2ca6dac0f48b">ex_put_variable_names</a>(exoid, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a>, num_element_fields, var_name);</div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; num_element_fields; j++) {</div>
<div class="line">        free(var_name[j]);</div>
<div class="line">      }</div>
<div class="line">      free(var_name);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num_nodal_fields + num_global_fields + num_element_fields &gt; 0) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;Domain %&quot;</span> PRId64 <span class="stringliteral">&quot;/%&quot;</span> PRId64 <span class="stringliteral">&quot;, Writing Timestep: &quot;</span>, i + 1, num_domains);</div>
<div class="line">      <span class="keywordflow">for</span> (t = 0; t &lt; num_timesteps; t++) {</div>
<div class="line">        realtyp time = t;</div>
<div class="line">        <a name="a29"></a><a class="code" href="group__ResultsData.html#ga2052c8728dac97589b94d9947e645797">ex_put_time</a>(exoid, t + 1, &amp;time);</div>
<div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%&quot;</span> PRId64 <span class="stringliteral">&quot;, &quot;</span>, t + 1);</div>
<div class="line">        <span class="keywordflow">if</span> (num_global_fields &gt; 0) {</div>
<div class="line">          err = <a name="a30"></a><a class="code" href="group__ResultsData.html#gafa1d828867b436631e99a63fd5ddbf05">ex_put_var</a>(exoid, t + 1, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a890b3a596358b8fe3bee8771f4ac84ac">EX_GLOBAL</a>, 1, 0, num_global_fields, globals);</div>
<div class="line">          <span class="keywordflow">if</span> (err) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;after ex_put_global_var, error = %d\n&quot;</span>, err);</div>
<div class="line">            <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">            exit(-1);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; num_nodal_fields; j++) {</div>
<div class="line">          err = <a class="code" href="group__ResultsData.html#gafa1d828867b436631e99a63fd5ddbf05">ex_put_var</a>(exoid, t + 1, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a7976e7fb59368794c38ff5da95b19873">EX_NODAL</a>, j + 1, 0, loc_num_nodes, x);</div>
<div class="line">          <span class="keywordflow">if</span> (err) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;after ex_put_nodal_var, error = %d\n&quot;</span>, err);</div>
<div class="line">            <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">            exit(-1);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; num_element_fields; j++) {</div>
<div class="line">          err = <a class="code" href="group__ResultsData.html#gafa1d828867b436631e99a63fd5ddbf05">ex_put_var</a>(exoid, t + 1, <a class="code" href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a>, j + 1, EBLK_ID, loc_num_elements, x);</div>
<div class="line">          <span class="keywordflow">if</span> (err) {</div>
<div class="line">            fprintf(stderr, <span class="stringliteral">&quot;after ex_put_element_var, error = %d\n&quot;</span>, err);</div>
<div class="line">            <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line">            exit(-1);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    err = <a class="code" href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a>(exoid);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;after ex_close, error = %d\n&quot;</span>, err);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (debug) {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;\tFile written.\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/*</span></div>
<div class="line"><span class="comment">   * Free Memory</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (num_domains &gt; 1) {</div>
<div class="line">    free(domain_connect);</div>
<div class="line">    free(elem_map);</div>
<div class="line">    free(loc_connect);</div>
<div class="line">    free(loc_xcoords);</div>
<div class="line">    free(loc_ycoords);</div>
<div class="line">    free(loc_zcoords);</div>
<div class="line">    free(node_map);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (num_global_fields &gt; 0) {</div>
<div class="line">    free(globals);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Create element local/global map</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This puts contiguous groups of elements in each domain.  This is</span></div>
<div class="line"><span class="comment"> * a somewhat reasonable map for a realistic application.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> create_elem_map(INT loc_num_elems, INT elem_num, INT *elem_map, INT map_origin)</div>
<div class="line">{</div>
<div class="line">  INT i;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; loc_num_elems; i++) {</div>
<div class="line">    elem_map[i] = map_origin + elem_num++;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Extract current domain&#39;s connectivity, referencing global node ids</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This extracts the &quot;domain connectivity,&quot; that is, the connectivity</span></div>
<div class="line"><span class="comment"> * of the elements in the current domain.  The node ids in the domain</span></div>
<div class="line"><span class="comment"> * connectivity reference global node ids.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> extract_connect(INT element_offset, INT num_elem, INT *elem_map, INT *connect,</div>
<div class="line">                     INT *domain_connect, INT map_origin)</div>
<div class="line">{</div>
<div class="line">  INT i, j, k, m, offset;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = element_offset, j = 0, m = 0; j &lt; num_elem; j++) {</div>
<div class="line">    <span class="keywordflow">if</span> (elem_map[j] == i + map_origin) { <span class="comment">/* extract this element */</span></div>
<div class="line">      offset = (i * NUM_NODES_PER_ELEM);</div>
<div class="line">      <span class="keywordflow">for</span> (k = offset; k &lt; offset + NUM_NODES_PER_ELEM; k++) {</div>
<div class="line">        domain_connect[m++] = connect[k];</div>
<div class="line">      }</div>
<div class="line">      i++;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The local/global node map is just the current domain&#39;s connectivity,</span></div>
<div class="line"><span class="comment"> * sorted, with duplicate entries removed.  This isn&#39;t obvious, but</span></div>
<div class="line"><span class="comment"> * trust me.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> create_node_map(INT len_map, INT len_connect, INT *domain_connect, INT *node_map,</div>
<div class="line">                     INT *loc_num_nodes, INT map_origin)</div>
<div class="line">{</div>
<div class="line">  INT cnt, i;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; len_map; i++) {</div>
<div class="line">    node_map[i] = 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; len_connect; i++) {</div>
<div class="line">    node_map[domain_connect[i] - map_origin] = 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  cnt = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; len_map; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (node_map[i] &gt; 0) {</div>
<div class="line">      node_map[cnt++] = i + map_origin;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  *loc_num_nodes = cnt;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/***********************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Using local/global node map, convert the domain connectivity</span></div>
<div class="line"><span class="comment"> * (referencing global node ids) to local connectivity (referencing</span></div>
<div class="line"><span class="comment"> * local node ids).</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * This requires inverting the local/global map, a relatively expensive</span></div>
<div class="line"><span class="comment"> * operation.  The procedure is:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   for every entry in the domain connectivity</span></div>
<div class="line"><span class="comment"> *     search the node map until found</span></div>
<div class="line"><span class="comment"> *     set the value of the entry in the local connectivity to</span></div>
<div class="line"><span class="comment"> *       the index of the located value in the node map</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> ***********************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> create_local_connect(INT *node_map, INT len_node_map, INT len_connect, INT *domain_connect,</div>
<div class="line">                          INT *loc_connect, INT map_origin)</div>
<div class="line">{</div>
<div class="line">  INT i, index;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; len_connect; i++) {</div>
<div class="line">    index = bin_search2(domain_connect[i], len_node_map, node_map);</div>
<div class="line">    <span class="keywordflow">if</span> (index != -1) { <span class="comment">/* found */</span></div>
<div class="line">      loc_connect[i] = index + map_origin;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      fprintf(stderr, <span class="stringliteral">&quot;error creating local connectivity; i = %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, i);</div>
<div class="line">      exit(-1);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*****************************************************************************</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Searches a monotonic list of values for the value, &#39;value&#39;.</span></div>
<div class="line"><span class="comment"> * It returns the index (0-based) of the first position found, which</span></div>
<div class="line"><span class="comment"> *   matches &#39;value&#39;.</span></div>
<div class="line"><span class="comment"> * The list is assumed to be monotonic, and consist of elements</span></div>
<div class="line"><span class="comment"> *   list[0], ..., list[n-1].</span></div>
<div class="line"><span class="comment"> * If no position in list matches value, it returns the value -1.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *****************************************************************************/</span></div>
<div class="line"> </div>
<div class="line">INT bin_search2(INT value, INT num, INT List[])</div>
<div class="line">{</div>
<div class="line">  INT top, bottom = 0, middle, g_mid;</div>
<div class="line"> </div>
<div class="line">  top = num - 1;</div>
<div class="line">  <span class="keywordflow">while</span> (bottom &lt;= top) {</div>
<div class="line">    middle = (bottom + top) &gt;&gt; 1;</div>
<div class="line">    g_mid  = List[middle];</div>
<div class="line">    <span class="keywordflow">if</span> (value &lt; g_mid) {</div>
<div class="line">      top = middle - 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; g_mid) {</div>
<div class="line">      bottom = middle + 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="keywordflow">return</span> middle; <span class="comment">/* found */</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> -1;</div>
<div class="line">} <span class="comment">/* bin_search2 */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*****************************************************************************/</span></div>
<div class="line"><span class="keywordtype">void</span> get_file_name(<span class="keyword">const</span> <span class="keywordtype">char</span> *base, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext, <span class="keywordtype">int</span> rank, <span class="keywordtype">int</span> nprocs, <span class="keyword">const</span> <span class="keywordtype">char</span> *other,</div>
<div class="line">                   <span class="keywordtype">char</span> *output)</div>
<div class="line">{</div>
<div class="line">  INT  i1, iTemp1;</div>
<div class="line">  INT  iMaxDigit = 0, iMyDigit = 0;</div>
<div class="line">  <span class="keywordtype">char</span> cTemp[128];</div>
<div class="line"> </div>
<div class="line">  output[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">  <a class="code" href="exodusII_8h.html#af1f4f3b83e65c1415d915910a48463ea">ex_copy_string</a>(output, base, MAX_STRING_LEN);</div>
<div class="line">  strcat(output, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">  strcat(output, ext);</div>
<div class="line">  <span class="keywordflow">if</span> (other != NULL) {</div>
<div class="line">    strcat(output, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">    strcat(output, other);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (nprocs &gt; 1) {</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Find out the number of digits needed to specify the processor ID.</span></div>
<div class="line"><span class="comment">     * This allows numbers like 01-99, i.e., prepending zeros to the</span></div>
<div class="line"><span class="comment">     * name to preserve proper alphabetic sorting of the files.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"> </div>
<div class="line">    iTemp1 = nprocs;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">      iTemp1 /= 10;</div>
<div class="line">      iMaxDigit++;</div>
<div class="line">    } <span class="keywordflow">while</span> (iTemp1 &gt;= 1);</div>
<div class="line"> </div>
<div class="line">    iTemp1 = rank;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">      iTemp1 /= 10;</div>
<div class="line">      iMyDigit++;</div>
<div class="line">    } <span class="keywordflow">while</span> (iTemp1 &gt;= 1);</div>
<div class="line"> </div>
<div class="line">    strcat(output, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">    sprintf(cTemp, <span class="stringliteral">&quot;%d&quot;</span>, nprocs);</div>
<div class="line">    strcat(output, cTemp);</div>
<div class="line">    strcat(output, <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Append the proper number of zeros to the filename.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i1 = 0; i1 &lt; iMaxDigit - iMyDigit; i1++) {</div>
<div class="line">      strcat(output, <span class="stringliteral">&quot;0&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    sprintf(cTemp, <span class="stringliteral">&quot;%d&quot;</span>, rank);</div>
<div class="line">    strcat(output, cTemp);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__ModelDescription_html_gad98c043e0e089bcb7a4f6662f96f7822"><div class="ttname"><a href="group__ModelDescription.html#gad98c043e0e089bcb7a4f6662f96f7822">ex_put_block</a></div><div class="ttdeci">int ex_put_block(int exoid, ex_entity_type blk_type, ex_entity_id blk_id, const char *entry_descrip, int64_t num_entries_this_blk, int64_t num_nodes_per_entry, int64_t num_edges_per_entry, int64_t num_faces_per_entry, int64_t num_attr_per_entry)</div><div class="ttdef"><b>Definition:</b> ex_put_block.c:47</div></div>
<div class="ttc" id="agroup__FileVars_html_ga01a03e58adddc706f5a34030746d604a"><div class="ttname"><a href="group__FileVars.html#ga01a03e58adddc706f5a34030746d604a">EX_IDS_INT64_DB</a></div><div class="ttdeci">#define EX_IDS_INT64_DB</div><div class="ttdef"><b>Definition:</b> exodusII.h:110</div></div>
<div class="ttc" id="agroup__FileVars_html_ga8b79c74f5807228669456780e4cdc6a9"><div class="ttname"><a href="group__FileVars.html#ga8b79c74f5807228669456780e4cdc6a9">EX_MAPS_INT64_DB</a></div><div class="ttdeci">#define EX_MAPS_INT64_DB</div><div class="ttdef"><b>Definition:</b> exodusII.h:109</div></div>
<div class="ttc" id="agroup__Utilities_html_ga8f47bbb035d32bbafc594c5ed3c00403"><div class="ttname"><a href="group__Utilities.html#ga8f47bbb035d32bbafc594c5ed3c00403">ex_opts</a></div><div class="ttdeci">int ex_opts(int options)</div><div class="ttdef"><b>Definition:</b> ex_opts.c:56</div></div>
<div class="ttc" id="agroup__ResultsData_html_ga4e10ac1ef1f40d2941f7918d527e539d"><div class="ttname"><a href="group__ResultsData.html#ga4e10ac1ef1f40d2941f7918d527e539d">ex_put_all_var_param</a></div><div class="ttdeci">int ex_put_all_var_param(int exoid, int num_g, int num_n, int num_e, int *elem_var_tab, int num_m, int *nset_var_tab, int num_s, int *sset_var_tab)</div><div class="ttdef"><b>Definition:</b> ex_put_all_var_param.c:45</div></div>
<div class="ttc" id="agroup__ResultsData_html_ga2052c8728dac97589b94d9947e645797"><div class="ttname"><a href="group__ResultsData.html#ga2052c8728dac97589b94d9947e645797">ex_put_time</a></div><div class="ttdeci">int ex_put_time(int exoid, int time_step, const void *time_value)</div><div class="ttdef"><b>Definition:</b> ex_put_time.c:51</div></div>
<div class="ttc" id="agroup__Utilities_html_gab9398d414e1316177db89782ed2a08c4"><div class="ttname"><a href="group__Utilities.html#gab9398d414e1316177db89782ed2a08c4">ex_set_option</a></div><div class="ttdeci">int ex_set_option(int exoid, ex_option_type option, int option_value)</div><div class="ttdef"><b>Definition:</b> ex_conv.c:416</div></div>
<div class="ttc" id="agroup__ModelDescription_html_ga03cff8e6e59a2c6b56cc1f232c2898c8"><div class="ttname"><a href="group__ModelDescription.html#ga03cff8e6e59a2c6b56cc1f232c2898c8">ex_put_concat_elem_block</a></div><div class="ttdeci">int ex_put_concat_elem_block(int exoid, const void_int *elem_blk_id, char *elem_type[], const void_int *num_elem_this_blk, const void_int *num_nodes_per_elem, const void_int *num_attr_this_blk, int define_maps)</div><div class="ttdef"><b>Definition:</b> ex_put_concat_elem_block.c:36</div></div>
<div class="ttc" id="aexodusII_8h_html_a1f649ed288d305ab55773ffd1d220490a4a98c34aed1692f0d9c87f0e0912588a"><div class="ttname"><a href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a4a98c34aed1692f0d9c87f0e0912588a">EX_NODE_MAP</a></div><div class="ttdeci">@ EX_NODE_MAP</div><div class="ttdef"><b>Definition:</b> exodusII.h:258</div></div>
<div class="ttc" id="agroup__Utilities_html_ga37c928f7e30c333ee7c704d04f7e3a87"><div class="ttname"><a href="group__Utilities.html#ga37c928f7e30c333ee7c704d04f7e3a87">ex_create</a></div><div class="ttdeci">#define ex_create(path, mode, comp_ws, io_ws)</div><div class="ttdef"><b>Definition:</b> exodusII.h:473</div></div>
<div class="ttc" id="agroup__ModelDescription_html_gaedc9233bcc6ffe7c634d67bd305ace2a"><div class="ttname"><a href="group__ModelDescription.html#gaedc9233bcc6ffe7c634d67bd305ace2a">ex_put_id_map</a></div><div class="ttdeci">int ex_put_id_map(int exoid, ex_entity_type map_type, const void_int *map)</div><div class="ttdef"><b>Definition:</b> ex_put_id_map.c:37</div></div>
<div class="ttc" id="agroup__FileVars_html_ga5527c0f72dbf64338abf0a3e1fc01e10"><div class="ttname"><a href="group__FileVars.html#ga5527c0f72dbf64338abf0a3e1fc01e10">EX_BULK_INT64_DB</a></div><div class="ttdeci">#define EX_BULK_INT64_DB</div><div class="ttdef"><b>Definition:</b> exodusII.h:111</div></div>
<div class="ttc" id="agroup__FileVars_html_ga6eb827ba708bd54aa72a5ac8468d4093"><div class="ttname"><a href="group__FileVars.html#ga6eb827ba708bd54aa72a5ac8468d4093">EX_MAPS_INT64_API</a></div><div class="ttdeci">#define EX_MAPS_INT64_API</div><div class="ttdef"><b>Definition:</b> exodusII.h:117</div></div>
<div class="ttc" id="agroup__Utilities_html_gabccf733ba6ef7e8a51595eb34c4f94ff"><div class="ttname"><a href="group__Utilities.html#gabccf733ba6ef7e8a51595eb34c4f94ff">ex_close</a></div><div class="ttdeci">int ex_close(int exoid)</div><div class="ttdef"><b>Definition:</b> ex_close.c:47</div></div>
<div class="ttc" id="aexodusII_8h_html_a1f649ed288d305ab55773ffd1d220490a890b3a596358b8fe3bee8771f4ac84ac"><div class="ttname"><a href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a890b3a596358b8fe3bee8771f4ac84ac">EX_GLOBAL</a></div><div class="ttdeci">@ EX_GLOBAL</div><div class="ttdef"><b>Definition:</b> exodusII.h:262</div></div>
<div class="ttc" id="aexodusII_8h_html_a8e04765c48d2d3c6806dc89d6c3db1feac85b3327ce99395f3faf0d542b8b3a0a"><div class="ttname"><a href="exodusII_8h.html#a8e04765c48d2d3c6806dc89d6c3db1feac85b3327ce99395f3faf0d542b8b3a0a">EX_ABORT</a></div><div class="ttdeci">@ EX_ABORT</div><div class="ttdef"><b>Definition:</b> exodusII.h:277</div></div>
<div class="ttc" id="aexodusII_8h_html_a1f649ed288d305ab55773ffd1d220490aade15ee9d30e8609779682eadccf1291"><div class="ttname"><a href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aade15ee9d30e8609779682eadccf1291">EX_ELEM_MAP</a></div><div class="ttdeci">@ EX_ELEM_MAP</div><div class="ttdef"><b>Definition:</b> exodusII.h:257</div></div>
<div class="ttc" id="agroup__ResultsData_html_gae487ed3a7cd9dcef6eca2ca6dac0f48b"><div class="ttname"><a href="group__ResultsData.html#gae487ed3a7cd9dcef6eca2ca6dac0f48b">ex_put_variable_names</a></div><div class="ttdeci">int ex_put_variable_names(int exoid, ex_entity_type obj_type, int num_vars, char *var_names[])</div><div class="ttdef"><b>Definition:</b> ex_put_variable_names.c:125</div></div>
<div class="ttc" id="agroup__FileVars_html_gadeed66ded179e51a8858254052a76ba4"><div class="ttname"><a href="group__FileVars.html#gadeed66ded179e51a8858254052a76ba4">EX_CLOBBER</a></div><div class="ttdeci">#define EX_CLOBBER</div><div class="ttdef"><b>Definition:</b> exodusII.h:93</div></div>
<div class="ttc" id="aexodusII_8h_html_a1f649ed288d305ab55773ffd1d220490a7976e7fb59368794c38ff5da95b19873"><div class="ttname"><a href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490a7976e7fb59368794c38ff5da95b19873">EX_NODAL</a></div><div class="ttdeci">@ EX_NODAL</div><div class="ttdef"><b>Definition:</b> exodusII.h:245</div></div>
<div class="ttc" id="agroup__ModelDescription_html_ga359b6d011348ed04746217e67612f3c1"><div class="ttname"><a href="group__ModelDescription.html#ga359b6d011348ed04746217e67612f3c1">ex_put_conn</a></div><div class="ttdeci">int ex_put_conn(int exoid, ex_entity_type blk_type, ex_entity_id blk_id, const void_int *node_conn, const void_int *elem_edge_conn, const void_int *elem_face_conn)</div><div class="ttdef"><b>Definition:</b> ex_put_conn.c:44</div></div>
<div class="ttc" id="aexodusII_8h_html"><div class="ttname"><a href="exodusII_8h.html">exodusII.h</a></div></div>
<div class="ttc" id="agroup__FileOptions_html_gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0ad067190db4fac3cbc8f5c4f99a1c322a"><div class="ttname"><a href="group__FileOptions.html#gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0ad067190db4fac3cbc8f5c4f99a1c322a">EX_OPT_COMPRESSION_SHUFFLE</a></div><div class="ttdeci">@ EX_OPT_COMPRESSION_SHUFFLE</div><div class="ttdef"><b>Definition:</b> exodusII.h:229</div></div>
<div class="ttc" id="agroup__ModelDescription_html_gaad1d6ddd57d1fa8f94da25d505e8c7ba"><div class="ttname"><a href="group__ModelDescription.html#gaad1d6ddd57d1fa8f94da25d505e8c7ba">ex_put_init</a></div><div class="ttdeci">int ex_put_init(int exoid, const char *title, int64_t num_dim, int64_t num_nodes, int64_t num_elem, int64_t num_elem_blk, int64_t num_node_sets, int64_t num_side_sets)</div><div class="ttdef"><b>Definition:</b> ex_put_init.c:53</div></div>
<div class="ttc" id="agroup__FileVars_html_ga8163fd2a9d4320d3a452bbd54ee6a512"><div class="ttname"><a href="group__FileVars.html#ga8163fd2a9d4320d3a452bbd54ee6a512">EX_IDS_INT64_API</a></div><div class="ttdeci">#define EX_IDS_INT64_API</div><div class="ttdef"><b>Definition:</b> exodusII.h:118</div></div>
<div class="ttc" id="agroup__ModelDescription_html_ga7b04e195e3fa979ba07470b860d70145"><div class="ttname"><a href="group__ModelDescription.html#ga7b04e195e3fa979ba07470b860d70145">ex_put_coord</a></div><div class="ttdeci">int ex_put_coord(int exoid, const void *x_coor, const void *y_coor, const void *z_coor)</div><div class="ttdef"><b>Definition:</b> ex_put_coord.c:87</div></div>
<div class="ttc" id="aexodusII_8h_html_a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286"><div class="ttname"><a href="exodusII_8h.html#a1f649ed288d305ab55773ffd1d220490aecdd2cbb9f2805c308dedb77c6ebe286">EX_ELEM_BLOCK</a></div><div class="ttdeci">@ EX_ELEM_BLOCK</div><div class="ttdef"><b>Definition:</b> exodusII.h:252</div></div>
<div class="ttc" id="aexodusII_8h_html_a8e04765c48d2d3c6806dc89d6c3db1feae2153f7d84ce02bf6947dae81018d5d9"><div class="ttname"><a href="exodusII_8h.html#a8e04765c48d2d3c6806dc89d6c3db1feae2153f7d84ce02bf6947dae81018d5d9">EX_VERBOSE</a></div><div class="ttdeci">@ EX_VERBOSE</div><div class="ttdef"><b>Definition:</b> exodusII.h:275</div></div>
<div class="ttc" id="agroup__FileOptions_html_gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0a56598a35ce7443245ddcd3370e7527b2"><div class="ttname"><a href="group__FileOptions.html#gga790e5d19a7cc9c2f8d4fd5a49a2c5dd0a56598a35ce7443245ddcd3370e7527b2">EX_OPT_COMPRESSION_LEVEL</a></div><div class="ttdeci">@ EX_OPT_COMPRESSION_LEVEL</div><div class="ttdef"><b>Definition:</b> exodusII.h:228</div></div>
<div class="ttc" id="agroup__FileVars_html_ga0f0209ea697749096d1067c65ad57087"><div class="ttname"><a href="group__FileVars.html#ga0f0209ea697749096d1067c65ad57087">EX_BULK_INT64_API</a></div><div class="ttdeci">#define EX_BULK_INT64_API</div><div class="ttdef"><b>Definition:</b> exodusII.h:119</div></div>
<div class="ttc" id="agroup__ResultsData_html_gafa1d828867b436631e99a63fd5ddbf05"><div class="ttname"><a href="group__ResultsData.html#gafa1d828867b436631e99a63fd5ddbf05">ex_put_var</a></div><div class="ttdeci">int ex_put_var(int exoid, int time_step, ex_entity_type var_type, int var_index, ex_entity_id obj_id, int64_t num_entries_this_obj, const void *var_vals)</div><div class="ttdef"><b>Definition:</b> ex_put_var.c:234</div></div>
<div class="ttc" id="aexodusII_8h_html_af1f4f3b83e65c1415d915910a48463ea"><div class="ttname"><a href="exodusII_8h.html#af1f4f3b83e65c1415d915910a48463ea">ex_copy_string</a></div><div class="ttdeci">char * ex_copy_string(char *dest, char const *source, size_t elements)</div><div class="ttdef"><b>Definition:</b> ex_utils.c:2289</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
